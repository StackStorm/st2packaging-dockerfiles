api:
  image: stackstorm/st2api:${ST2_VERSION}
  links:
    - mongo
    - rabbitmq
  volumes_from:
    - data

auth:
  image: stackstorm/st2auth:${ST2_VERSION}
  links:
    - api
    - mongo
  volumes_from:
    - data

stream:
  image: stackstorm/st2stream:${ST2_VERSION}
  links:
    - mongo
    - rabbitmq
  volumes_from:
    - data

notifier:
  image: stackstorm/st2notifier:${ST2_VERSION}
  links:
    - api
    - mongo
    - rabbitmq
  volumes_from:
    - data

resultstracker:
  image: stackstorm/st2resultstracker:${ST2_VERSION}
  links:
    - api
    - mongo
    - rabbitmq
  volumes_from:
    - data

rulesengine:
  image: stackstorm/st2rulesengine:${ST2_VERSION}
  links:
    - api
    - mongo
    - rabbitmq
  volumes_from:
    - data

sensorcontainer:
  image: stackstorm/st2sensorcontainer:${ST2_VERSION}
  links:
    - api
    - mongo
    - rabbitmq
  volumes_from:
    - data

garbagecollector:
  image: stackstorm/st2garbagecollector:${ST2_VERSION}
  links:
    - api
    - mongo
    - rabbitmq
  volumes_from:
    - data

actionrunner:
  image: stackstorm/st2actionrunner:${ST2_VERSION}
  links:
    - api
    - auth
    - mongo
    - rabbitmq
  volumes_from:
    - data

## External Services
mongo:
  image: mongo:3.2

rabbitmq:
  image: rabbitmq

## Data container
data:
  build: ./data
  volumes:
    - /etc/st2
    - /opt/stackstorm
  links:
    - rabbitmq
    - mongo

## Client container
client:
  build: ./client
  links:
    - api
    - auth
